<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4A5568">
    <title>Teste de Otimiza√ß√µes - RFCP Tracker</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==">
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==">
    
    <!-- PWA -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="RFCP Tracker">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f7fafc;
        }
        
        .test-section h3 {
            color: #4a5568;
            margin-top: 0;
        }
        
        .test-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        
        .test-button:hover {
            background: #3182ce;
        }
        
        .results {
            margin-top: 20px;
            padding: 20px;
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.pass {
            background: #48bb78;
            color: white;
        }
        
        .status.fail {
            background: #f56565;
            color: white;
        }
        
        .status.pending {
            background: #ed8936;
            color: white;
        }
        
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Teste de Otimiza√ß√µes</h1>
            <p>Valida√ß√£o das melhorias implementadas no RFCP Tracker</p>
        </div>

        <div class="test-section">
            <h3>üìã Recursos Implementados</h3>
            <ul class="feature-list">
                <li>
                    <strong>Favicon</strong>
                    <span class="status pending" id="favicon-status">TESTANDO</span>
                    <br><small>Base64 embedded favicon para evitar erro 404</small>
                </li>
                <li>
                    <strong>PWA (Progressive Web App)</strong>
                    <span class="status pending" id="pwa-status">TESTANDO</span>
                    <br><small>Meta tags, manifest e Service Worker para funcionalidade offline</small>
                </li>
                <li>
                    <strong>Service Worker</strong>
                    <span class="status pending" id="sw-status">TESTANDO</span>
                    <br><small>Cache inteligente para melhor performance</small>
                </li>
                <li>
                    <strong>Sistema de Cache</strong>
                    <span class="status pending" id="cache-status">TESTANDO</span>
                    <br><small>LocalStorage com expira√ß√£o para objetivos</small>
                </li>
                <li>
                    <strong>Analytics</strong>
                    <span class="status pending" id="analytics-status">TESTANDO</span>
                    <br><small>Rastreamento de intera√ß√µes do usu√°rio</small>
                </li>
                <li>
                    <strong>Headers Sanitizados</strong>
                    <span class="status pending" id="headers-status">TESTANDO</span>
                    <br><small>Corre√ß√£o de encoding ISO-8859-1 para GitHub API</small>
                </li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üß™ Executar Testes</h3>
            <button class="test-button" onclick="runAllTests()">Executar Todos os Testes</button>
            <button class="test-button" onclick="testServiceWorker()">Testar Service Worker</button>
            <button class="test-button" onclick="testCache()">Testar Cache</button>
            <button class="test-button" onclick="testAnalytics()">Testar Analytics</button>
            <button class="test-button" onclick="clearResults()">Limpar Resultados</button>
        </div>

        <div class="results" id="test-results">
            Clique em "Executar Todos os Testes" para come√ßar...
        </div>
    </div>

    <script>
        let testResults = '';

        function log(message) {
            testResults += message + '\n';
            document.getElementById('test-results').textContent = testResults;
        }

        function updateStatus(id, status) {
            const element = document.getElementById(id);
            element.textContent = status === 'pass' ? 'PASS' : status === 'fail' ? 'FAIL' : 'TESTANDO';
            element.className = `status ${status}`;
        }

        function clearResults() {
            testResults = '';
            document.getElementById('test-results').textContent = 'Resultados limpos...';
            
            // Reset all status
            ['favicon', 'pwa', 'sw', 'cache', 'analytics', 'headers'].forEach(test => {
                updateStatus(test + '-status', 'pending');
            });
        }

        async function runAllTests() {
            clearResults();
            log('üîç Iniciando testes de otimiza√ß√£o...\n');

            await testFavicon();
            await testPWA();
            await testServiceWorker();
            await testCache();
            await testAnalytics();
            await testHeaders();

            log('\nüìã TESTES CONCLU√çDOS!');
        }

        async function testFavicon() {
            log('üìù Testando favicon...');
            
            try {
                const link = document.querySelector('link[rel="icon"]');
                const shortcutIcon = document.querySelector('link[rel="shortcut icon"]');
                
                if (link || shortcutIcon) {
                    updateStatus('favicon-status', 'pass');
                    log('‚úÖ Favicon configurado');
                } else {
                    updateStatus('favicon-status', 'fail');
                    log('‚ùå Favicon n√£o encontrado');
                }
            } catch (error) {
                updateStatus('favicon-status', 'fail');
                log('‚ùå Erro ao testar favicon: ' + error.message);
            }
        }

        async function testPWA() {
            log('üì± Testando PWA...');
            
            try {
                const manifest = document.querySelector('link[rel="manifest"]');
                const themeColor = document.querySelector('meta[name="theme-color"]');
                const viewport = document.querySelector('meta[name="viewport"]');
                
                if (manifest && themeColor && viewport) {
                    updateStatus('pwa-status', 'pass');
                    log('‚úÖ PWA configurado corretamente');
                } else {
                    updateStatus('pwa-status', 'fail');
                    log('‚ùå Configura√ß√µes PWA incompletas');
                }
            } catch (error) {
                updateStatus('pwa-status', 'fail');
                log('‚ùå Erro ao testar PWA: ' + error.message);
            }
        }

        async function testServiceWorker() {
            log('‚öôÔ∏è Testando Service Worker...');
            
            try {
                if ('serviceWorker' in navigator) {
                    // Tentar registrar o Service Worker se n√£o estiver registrado
                    try {
                        await navigator.serviceWorker.register('./sw.js');
                        log('üìù Service Worker registrado');
                    } catch (regError) {
                        log('‚ö†Ô∏è Erro ao registrar SW: ' + regError.message);
                    }

                    const registration = await navigator.serviceWorker.getRegistration();
                    
                    if (registration) {
                        updateStatus('sw-status', 'pass');
                        log('‚úÖ Service Worker ativo');
                    } else {
                        updateStatus('sw-status', 'fail');
                        log('‚ùå Service Worker n√£o registrado');
                    }
                } else {
                    updateStatus('sw-status', 'fail');
                    log('‚ùå Service Worker n√£o suportado');
                }
            } catch (error) {
                updateStatus('sw-status', 'fail');
                log('‚ùå Erro ao testar Service Worker: ' + error.message);
            }
        }

        async function testCache() {
            log('üíæ Testando cache...');
            
            try {
                // Testar localStorage
                const testKey = 'rfcp_test_cache';
                const testValue = { test: true, timestamp: Date.now() };
                
                localStorage.setItem(testKey, JSON.stringify(testValue));
                const stored = JSON.parse(localStorage.getItem(testKey));
                
                if (stored && stored.test === true) {
                    updateStatus('cache-status', 'pass');
                    log('‚úÖ Sistema de cache funcionando');
                    localStorage.removeItem(testKey); // Cleanup
                } else {
                    updateStatus('cache-status', 'fail');
                    log('‚ùå Sistema de cache com problemas');
                }
            } catch (error) {
                updateStatus('cache-status', 'fail');
                log('‚ùå Erro ao testar cache: ' + error.message);
            }
        }

        async function testAnalytics() {
            log('üìä Testando analytics...');
            
            try {
                // Simular evento de analytics
                const event = {
                    type: 'test_event',
                    data: { test: true },
                    timestamp: new Date().toISOString()
                };
                
                // Tentar armazenar evento
                const eventsKey = 'rfcp_analytics_events';
                let events = JSON.parse(localStorage.getItem(eventsKey) || '[]');
                events.push(event);
                localStorage.setItem(eventsKey, JSON.stringify(events));
                
                // Verificar se foi armazenado
                const storedEvents = JSON.parse(localStorage.getItem(eventsKey));
                if (storedEvents && storedEvents.length > 0) {
                    updateStatus('analytics-status', 'pass');
                    log('‚úÖ Sistema de analytics funcionando');
                    localStorage.removeItem(eventsKey); // Cleanup
                } else {
                    updateStatus('analytics-status', 'fail');
                    log('‚ùå Sistema de analytics com problemas');
                }
            } catch (error) {
                updateStatus('analytics-status', 'fail');
                log('‚ùå Erro ao testar analytics: ' + error.message);
            }
        }

        async function testHeaders() {
            log('üì° Testando headers...');
            
            try {
                // Simular sanitiza√ß√£o de headers
                const testToken = 'test-token-with-special-chars-√ß√£√µ';
                const cleanToken = testToken.replace(/[^\x00-\x7F]/g, '');
                
                if (cleanToken !== testToken && cleanToken.length < testToken.length) {
                    updateStatus('headers-status', 'pass');
                    log('‚úÖ Sanitiza√ß√£o de headers funcionando');
                } else if (cleanToken === testToken) {
                    updateStatus('headers-status', 'pass');
                    log('‚úÖ Headers OK (token sem caracteres especiais)');
                } else {
                    updateStatus('headers-status', 'fail');
                    log('‚ùå Problema na sanitiza√ß√£o de headers');
                }
            } catch (error) {
                updateStatus('headers-status', 'fail');
                log('‚ùå Erro ao testar headers: ' + error.message);
            }
        }

        // Executar testes automaticamente quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                log('üöÄ P√°gina carregada. Execute os testes quando estiver pronto.');
            }, 500);
        });
    </script>
</body>
</html>